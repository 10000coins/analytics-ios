machine:
  xcode:
    version: "8.0"

dependencies:
  pre:
    # - brew install xctool # Homebrew is actually not used on circle at the moment
    - sudo gem install xcpretty
    - sudo gem install cocoapods -v $(var=$(tail -1 Example/Podfile.lock); echo ${var##COCOAPODS:})
    - if cd ~/.cocoapods/repos/master; then git pull; else git clone https://github.com/CocoaPods/Specs.git ~/.cocoapods/repos/master; fi
    - pod setup --verbose
  override:
    - cd Example && pod install --verbose
  cache_directories:
    - Example/Pods
    - ~/.cocoapods

test:
  override:
    - make build-pretty
    - make test-pretty
    - make lint
    - make carthage
  # post:
    # - mv build/reports $CIRCLE_TEST_REPORTS/xcode # TODO: Turn me back on
    # - bash <(curl -s https://codecov.io/bash) #: TODO: Turn me back on
